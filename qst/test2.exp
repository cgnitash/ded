
# tests nested process with nested tags. Similar to a foraging experiment, 
# except that the score of a single evaluation is the average score across 
# multiple lifetime evaluations of an organism 

__substrate e = $markov_brain 
{
  hiddens = 5
  outputs = 2
  inputs = 4
}

__population Population = $linear 
{ 
  size = 40
  entity = !e 
  track_lineage = true 
}

# this Process just runs the nested Process "nums" times
# and averages the results
__process rep_for = $replicate 
{
  num = [ 2 3 4 ] 
  env = $forager 
        { 
          ? food_eaten 3 
          action <- out_sense 
          line_of_sight -> in_sense 
        }
  env:food_eaten => env:x # the tag that needs to be averaged is food_eaten
                          # but replicate calls it x 

  ? fx 10                 # and the average is called fx
}
    
__process fs = $sequence  
{
  first   = !rep_for 
  second = $elite_replacement 
           { 
             strength = 0.4   
           }
  first:fx => second:value  # so fx (generated by replicate) needs to be bound 
                            # to what the optimizer uses
}


__process Process = $cycle  
{ 
  count = 101
  world = !fs
}

